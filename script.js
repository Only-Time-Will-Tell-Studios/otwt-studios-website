// --- TRANSLATIONS DICTIONARY ---
const translations = {
    'en': {
        'nav_home': 'Home',
        'nav_games': 'Games',
        'nav_about': 'About',
        'nav_contact': 'Contact',
        'hero_rpg': 'RPG / Action',
        'hero_horror': 'Horror / Survival',
        'hero_racing': 'Racing / Arcade',
        'home_title': 'WE BUILD WORLDS',
        'home_desc': 'OTWT Studios is dedicated to pushing the boundaries of interactive entertainment. We combine bleeding-edge graphics with deep, narrative-driven gameplay.',
        'btn_team': 'Meet The Team',
        'stats_awards': 'Awards Won',
        'stats_players': 'Players',
        'footer_touch': 'GET IN TOUCH',
        'footer_rights': '© 2025 OTWT Studios. All Rights Reserved.',
        'about_mission': 'OUR MISSION',
        'about_forge': 'FORGING THE FUTURE',
        'about_desc': 'OTWT Studios started in a garage in 2015 with a simple dream: to create games that don\'t just entertain, but transport players to entirely new dimensions.',
        'team_squad': 'THE SQUAD',
        'role_cd': 'Creative Director',
        'role_le': 'Lead Engineer',
        'role_ad': 'Art Director',
        'role_sd': 'Senior Developer',
        'role_ae': 'Audio Engineer',
        'role_nl': 'Narrative Lead',
        'game_desc_cyber': 'In the year 2099, corporations rule the skyline. Join the resistance in this open-world RPG where hacking is your weapon and stealth is your shield.',
        'game_desc_void': 'Stranded on a derelict station, you must survive entities that track you by sound. A terrifying VR-compatible experience.',
        'game_desc_neon': 'High-speed synthwave racing through procedurally generated cities. Compete online for the top of the leaderboard.',
        'btn_buy': 'BUY NOW',
        'header_games': 'Games',
        'contact_title': 'CONTACT US',
        'contact_sub': 'JOIN THE MAILING LIST',
        'contact_privacy': 'We promise not to sell your personal data. We hate spam too.',
        'btn_sub': 'SUBSCRIBE',
        'settings_title': 'SETTINGS',
        'lbl_lang': 'Language',
        'lbl_anim': 'Animations',
        'btn_clear': 'Clear Cookies'
    },
    'fr': {
        'nav_home': 'Accueil',
        'nav_games': 'Jeux',
        'nav_about': 'À propos',
        'nav_contact': 'Contact',
        'hero_rpg': 'Jeu de Rôle / Action',
        'hero_horror': 'Horreur / Survie',
        'hero_racing': 'Course / Arcade',
        'home_title': 'NOUS CRÉONS DES MONDES',
        'home_desc': 'OTWT Studios repousse les limites du divertissement interactif. Nous combinons des graphismes de pointe avec un gameplay narratif profond.',
        'btn_team': 'Rencontrer l\'équipe',
        'stats_awards': 'Prix Remportés',
        'stats_players': 'Joueurs',
        'footer_touch': 'CONTACTEZ-NOUS',
        'footer_rights': '© 2025 OTWT Studios. Tous droits réservés.',
        'about_mission': 'NOTRE MISSION',
        'about_forge': 'FORGER L\'AVENIR',
        'about_desc': 'OTWT Studios a débuté dans un garage en 2015 avec un rêve simple : créer des jeux qui transportent les joueurs vers de nouvelles dimensions.',
        'team_squad': 'L\'ÉQUIPE',
        'role_cd': 'Directeur Créatif',
        'role_le': 'Ingénieur Principal',
        'role_ad': 'Directeur Artistique',
        'role_sd': 'Développeur Senior',
        'role_ae': 'Ingénieur Son',
        'role_nl': 'Responsable Narratif',
        'game_desc_cyber': 'En 2099, les corporations dominent l\'horizon. Rejoignez la résistance dans ce RPG en monde ouvert où le piratage est votre arme.',
        'game_desc_void': 'Échoué sur une station abandonnée, survivez à des entités qui vous traquent au son. Une expérience terrifiante compatible VR.',
        'game_desc_neon': 'Courses synthwave à grande vitesse dans des villes procédurales. Affrontez les autres en ligne.',
        'btn_buy': 'ACHETER',
        'header_games': 'Jeux',
        'contact_title': 'NOUS CONTACTER',
        'contact_sub': 'REJOINDRE LA LISTE',
        'contact_privacy': 'Nous ne vendons pas vos données personnelles. Nous détestons le spam.',
        'btn_sub': 'S\'ABONNER',
        'settings_title': 'PARAMÈTRES',
        'lbl_lang': 'Langue',
        'lbl_anim': 'Animations',
        'btn_clear': 'Effacer Cookies'
    },
    'de': {
        'nav_home': 'Startseite',
        'nav_games': 'Spiele',
        'nav_about': 'Über Uns',
        'nav_contact': 'Kontakt',
        'hero_rpg': 'Rollenspiel / Action',
        'hero_horror': 'Horror / Überleben',
        'hero_racing': 'Rennspiel / Arcade',
        'home_title': 'WIR BAUEN WELTEN',
        'home_desc': 'OTWT Studios widmet sich der Erweiterung der Grenzen interaktiver Unterhaltung. Wir kombinieren modernste Grafik mit tiefgründigem Gameplay.',
        'btn_team': 'Triff das Team',
        'stats_awards': 'Auszeichnungen',
        'stats_players': 'Spieler',
        'footer_touch': 'KONTAKT AUFNEHMEN',
        'footer_rights': '© 2025 OTWT Studios. Alle Rechte vorbehalten.',
        'about_mission': 'UNSERE MISSION',
        'about_forge': 'DIE ZUKUNFT SCHMIEDEN',
        'about_desc': 'OTWT Studios begann 2015 in einer Garage mit einem einfachen Traum: Spiele zu erschaffen, die Spieler in völlig neue Dimensionen entführen.',
        'team_squad': 'DAS TEAM',
        'role_cd': 'Kreativdirektor',
        'role_le': 'Leitender Ingenieur',
        'role_ad': 'Art Director',
        'role_sd': 'Senior Entwickler',
        'role_ae': 'Toningenieur',
        'role_nl': 'Narrative Leitung',
        'game_desc_cyber': 'Im Jahr 2099 beherrschen Konzerne die Skyline. Schließe dich dem Widerstand in diesem Open-World-RPG an.',
        'game_desc_void': 'Gestrandet auf einer verlassenen Station müssen Sie Wesen überleben, die Sie anhand von Geräuschen aufspüren.',
        'game_desc_neon': 'Hochgeschwindigkeits-Synthwave-Rennen durch prozedural generierte Städte. Kämpfe online um die Spitze.',
        'btn_buy': 'KAUFEN',
        'header_games': 'Spiele',
        'contact_title': 'KONTAKTIERE UNS',
        'contact_sub': 'NEWSLETTER ABONNIEREN',
        'contact_privacy': 'Wir verkaufen Ihre Daten nicht. Wir hassen Spam auch.',
        'btn_sub': 'ABONNIEREN',
        'settings_title': 'EINSTELLUNGEN',
        'lbl_lang': 'Sprache',
        'lbl_anim': 'Animationen',
        'btn_clear': 'Cookies Löschen'
    }
};

// --- COOKIE HELPERS ---
function setCookie(name, value, days) {
    let expires = "";
    if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "") + expires + "; path=/";
}

function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}

function eraseCookie(name) {
    document.cookie = name + '=; Max-Age=-99999999;';
}

// --- APP LOGIC ---
document.addEventListener("DOMContentLoaded", () => {

    // 1. LANGUAGE SETUP
    const langSelect = document.getElementById('lang-select');
    let currentLang = getCookie('nexus_lang');
    
    // If no cookie, detect browser lang
    if (!currentLang) {
        const browserLang = navigator.language || navigator.userLanguage;
        currentLang = browserLang.split('-')[0]; // e.g., 'en-US' -> 'en'
    }

    // Verify support, default to EN if not supported
    if (!translations[currentLang]) currentLang = 'en';

    // Apply
    if (langSelect) langSelect.value = currentLang;
    updateLanguage(currentLang);

    // 2. ANIMATION SETUP
    const animCheck = document.getElementById('anim-check');
    const animCookie = getCookie('nexus_anim');
    let animEnabled = true; // Default

    if (animCookie !== null) {
        animEnabled = (animCookie === 'true');
    }

    if (animCheck) animCheck.checked = animEnabled;
    toggleAnimations(animEnabled);


    // 3. EVENT LISTENERS (SETTINGS)
    if (langSelect) {
        langSelect.addEventListener('change', (e) => {
            const newLang = e.target.value;
            setCookie('nexus_lang', newLang, 365);
            updateLanguage(newLang);
        });
    }

    if (animCheck) {
        animCheck.addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            setCookie('nexus_anim', isChecked, 365);
            toggleAnimations(isChecked);
        });
    }

    const clearBtn = document.getElementById('clearCookies');
    if (clearBtn) {
        clearBtn.addEventListener('click', () => {
            eraseCookie('nexus_lang');
            eraseCookie('nexus_anim');
            alert('Cookies cleared! Reloading...');
            location.reload();
        });
    }

    // 4. SETTINGS POPUP LOGIC
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPopup = document.getElementById('settingsPopup');

    if(settingsBtn && settingsPopup) {
        settingsBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            settingsPopup.classList.toggle('active');
        });
        document.addEventListener('click', (e) => {
            if (!settingsPopup.contains(e.target) && e.target !== settingsBtn) {
                settingsPopup.classList.remove('active');
            }
        });
    }

    // 5. SCROLL LOGIC & HEADER
    const navbar = document.getElementById('navbar');
    let lastScrollY = window.scrollY;

    window.addEventListener('scroll', () => {
        const currentScrollY = window.scrollY;
        if (currentScrollY > 50 && currentScrollY > lastScrollY) {
            navbar.classList.add('hidden');
        } else if (currentScrollY < 10) {
            navbar.classList.remove('hidden');
        }
        lastScrollY = currentScrollY;
    });

    document.addEventListener('mousemove', (e) => {
        if (navbar.classList.contains('hidden') && e.clientY < 80) {
            navbar.classList.remove('hidden');
        }
    });

    // 6. SCROLL FADE ANIMATION
    // Only run if animations are enabled
    if (animEnabled) {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = "1";
                    entry.target.style.transform = "translateY(0)";
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        const fadeElements = document.querySelectorAll('.text-box, .stat-box, .game-description, .member-card, .contact-wrapper');
        fadeElements.forEach(el => {
            el.style.opacity = "0";
            el.style.transform = "translateY(20px)";
            el.style.transition = "all 0.6s ease-out";
            observer.observe(el);
        });
    } else {
        // If animations off, ensure elements are visible
        document.querySelectorAll('.text-box, .stat-box, .game-description, .member-card, .contact-wrapper').forEach(el => {
            el.style.opacity = "1";
            el.style.transform = "none";
        });
    }
});

function updateLanguage(lang) {
    const data = translations[lang];
    // Find all elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (data[key]) {
            el.innerText = data[key];
        }
    });
}

function toggleAnimations(enabled) {
    if (!enabled) {
        document.body.classList.add('no-anim');
    } else {
        document.body.classList.remove('no-anim');
    }
}